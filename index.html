<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>kibela2esaã¨æ­£è¦è¡¨ç¾ - è¡¨å‚é“.rb #43</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css">
		<link rel="stylesheet" href="css/my.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1>kibela2esa<br>ã¨<br>æ­£è¦è¡¨ç¾</h1>
					<p>2019-02-07</p>
					<p>è¡¨å‚é“.rb #43</p>
					<p>ã†ãªã™ã‘</p>
				</section>
				<section>
					<h2>è‡ªå·±ç´¹ä»‹</h2>
					<div class="flex-container">
						<div class='item-40'>
							<img src="img/icon_raw.jpg">
						</div>
						<div class='item-60'>
							<ul>
								<li>åå‰: ã†ãªã™ã‘</li>
								<li>æ‰€å±: æ ªå¼ä¼šç¤¾ãƒãƒ³ã‚¯
									<ul><li>ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢</li></ul>
								</li>
								<li>Twitter: <a href="https://twitter.com/yu_suke1994">@yu_suke1994</a></li>
								<li>GitHub: <a href="https://github.com/unasuke">@unasuke</a></li>
								<li>Mastodon <a href="https://mstdn.unasuke.com/@unasuke">@unasuke@mstdn.unasuke.com</a></li>
							</ul>
						</div>
					</div>
				</section>
				<section>
					<h2>kibela2esa</h2>
					<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">ã€ãŠçŸ¥ã‚‰ã›ã€‘ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£esaãƒ„ãƒ¼ãƒ«ã« â€œHolyGrail/kibela2esaâ€œ ã‚’è¿½åŠ ã—ã¾ã—ãŸ<a href="https://t.co/oWmdHuuhnX">https://t.co/oWmdHuuhnX</a><a href="https://t.co/a5jGUIbngX">https://t.co/a5jGUIbngX</a></p>&mdash; esa_io (@esa_io) <a href="https://twitter.com/esa_io/status/1090837335531433984?ref_src=twsrc%5Etfw">2019å¹´1æœˆ31æ—¥</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
					<p>kibelaã®è¨˜äº‹ã‚’esaã«ç§»è¡Œã™ã‚‹script</p>
					<small>gemã§ã¯ãªã„</small>
				</section>
				<section>
					<h2>kibela2esaã«ãŠã‘ã‚‹æ­£è¦è¡¨ç¾</h2>
					<pre><code class='ruby'>TEAM='unasuke'
TITLE_PATTERN = %r[\A.*/kibela-#{TEAM}-\d+/(?&lt;kind&gt;wikis|blogs)/(?&lt;path&gt;[[:print:]]*/)*(?&lt;id&gt;\d)+-(?&lt;name&gt;[[:print:]]*)\.md\z]
ATTACHMENT_PATTERN = %r[^(?~http)(\.\./)*attachments/(?&lt;attachment_name&gt;\d+\.(png|JPG|jpg|jpeg|gif|PNG))]</code></pre>
					<small><a href="https://github.com/HolyGrail/kibela2esa/blob/939f5e8da54749d56360f370c6394bdb8862cdce/kibela.rb#L6-L7">kibela.rb#L6-L7</a></small>
					<p style="font-size: 5rem; font-weight: bold;">ãƒŠãƒ‹ã‚³ãƒ¬ï¼Ÿï¼Ÿï¼Ÿ</p>
				</section>
				<section>
					<h2>kibela2esaã«ãŠã‘ã‚‹æ­£è¦è¡¨ç¾</h2>
					<p>ã¿ã‚„ã™ãæ”¹è¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†</p>
					<pre><code class='ruby'>TEAM='unasuke'
TITLE_PATTERN = %r[\A.*
	/kibela-#{TEAM}-\d+
	/(?&lt;kind&gt;wikis|blogs)
	/(?&lt;path&gt;[[:print:]]*/)*
	(?&lt;id&gt;\d)+-(?&lt;name&gt;[[:print:]]*)\.md\z]x
ATTACHMENT_PATTERN = %r[^(?~http)
	(\.\./)*attachments/
	(?&lt;attachment_name&gt;\d+\.
		(png|JPG|jpg|jpeg|gif|PNG))
	]x</code></pre>
						<small>é›‘ã«æ”¹è¡Œã‚’å…¥ã‚Œã¾ã—ãŸãŒã€ã“ã‚Œã‚‚æ­£ã—ã„æ­£è¦è¡¨ç¾ã§ã™</small>
				</section>
				<section>
					<h2>æ­£è¦è¡¨ç¾ã®èª¬æ˜ã®å‰ã«</h2>
					<p>kibelaã®exportã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†</p>
				</section>
				<section>
					<h2>æ­£è¦è¡¨ç¾ã®èª¬æ˜ã®å‰ã«</h2>
					<h3>kibelaã®exportã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿</h3>
					<img src="https://i.imgur.com/b8L56Yx.png" width="60%">
				</section>
				<section>
					<h2>æ­£è¦è¡¨ç¾ã®èª¬æ˜ã®å‰ã«</h2>
					<h3>kibelaã®exportã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿</h3>
					<ul>
						<li>kibela-unasuke-0/attachments/3.png</li>
						<li>kibela-unasuke-0/wikis/2019/01/18/1-some.md</li>
						<li>kibela-unasuke-0/wikis/other/dir/2-hogehoge.md</li>
						<li>kibela-unasuke-0/blogs/unasuke/3-my_memo.md</li>
					</ul>
				</section>
				<section>
					<h2>kibelaã®exportã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿</h2>
					<h3>ä¸€èˆ¬åŒ–ã—ã¦ã¿ã¾ã—ã‚‡ã†</h3>
					<ul>
						<li>kibela-unasuke-*/attachments/*.png</li>
						<li>kibela-unasuke-*/wikis/**/1-some.md</li>
						<li>kibela-unasuke-*/wikis/**/2-hogehoge.md</li>
						<li>kibela-unasuke-*/blogs/**/3-my_memo.md</li>
					</ul>
				</section>
				<section>
					<h2>kibelaã®exportã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿</h2>
					<h3>ä¸€èˆ¬åŒ–ã—ã¦ã¿ã¾ã—ã‚‡ã† 2</h3>
					<ul>
						<li>kibela-unasuke-*/attachments/*.png</li>
						<li>kibela-unasuke-*/wikis/**/*-*.md</li>
						<li>kibela-unasuke-*/wikis/**/*-*.md</li>
						<li>kibela-unasuke-*/blogs/**/*-*.md</li>
					</ul>
					<br>
					<br>
					<p>ã‚ãƒ¼ãªã‚“ã¨ãªãã‚ã‹ã£ã¦ããŸ</p>
				</section>
				<section>
					<h2>exportã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ </h2>
					<h3>è¨˜äº‹ (blogs, wikis)</h3>
					<ol style="font-size: 85%;">
						<li>kibela-(team)-(æ•°å­—)/ ãŒãƒˆãƒƒãƒ—</li>
						<li>blogs/ ã‚‚ã—ãã¯ wikis/ãŒç¶šã</li>
						<li>(æŠ•ç¨¿è€…)/(ç•ªå·)-(ã‚¿ã‚¤ãƒˆãƒ«).md (blogã®å ´åˆ)</li>
						<li>(ã‚«ãƒ†ã‚´ãƒª)/(éšå±¤)/(ç•ªå·)-(ã‚¿ã‚¤ãƒˆãƒ«).md (wikiã®å ´åˆ)</li>
					</ol>
					<div class="fragment">
						<p>ã˜ã‚ƒã‚ã“ã‚Œã‚’æ­£è¦è¡¨ç¾ã«ã—ã¦ã„ãã¾ã—ã‚‡ã†</p>
					</div>
				</section>
				<section>
					<h2>exportã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ </h2>
					<h3>è¨˜äº‹ (blogs, wikis) ã®æ­£è¦è¡¨ç¾</h3>
					<pre><code class="ruby">TITLE_PATTERN = %r[
\A.* # å…ˆé ­ã«ä»»æ„ã®æ–‡å­—åˆ—ã‚’è¨±å®¹
  /kibela-#{TEAM}-\d+ # /kibela-teamå-æ•°å€¤ ã«ãƒãƒƒãƒ
  /(wikis|blogs)      # /wikis ã‹ /blogs ã«ãƒãƒƒãƒ
  /([[:print:]]*/)*   # /ä»»æ„ã®æ–‡å­—åˆ— ã®0å›ä»¥ä¸Šã®é€£ç¶šã«ãƒãƒƒãƒ
  (\d)+-([[:print:]]*)\.md # æ•°å€¤-ä»»æ„ã®æ–‡å­—åˆ—.md ã«ãƒãƒƒãƒ
  \z # æ–‡å­—åˆ—ã®æœ«å°¾
]x</code></pre>
					<p>æ­£è¦è¡¨ç¾ã¯ã§ããŸâ€¦â€¦</p>
					<p>ã®ã§ã€ãƒãƒƒãƒã—ãŸéƒ¨åˆ†ã‚’å–ã‚Šå‡ºã—ãŸã„</p>
				</section>
				<section>
					<h2>æ­£è¦è¡¨ç¾ã®ã‚­ãƒ£ãƒ—ãƒãƒ£</h2>
					<blockquote>
						ä¸¸æ‹¬å¼§ ( ) ã«ã‚ˆã£ã¦ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ 
					</blockquote>
					<blockquote>
1,2,... ã§ã¯ãªãã€åå‰ã‚’ä»˜ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ (?&lt;name&gt;pat)ã‚‚ã—ãã¯(?'name'pat)ã¨è¨˜è¿°ã—ã¾ã™ã€‚
					</blockquote>
					<a href='https://docs.ruby-lang.org/ja/latest/doc/spec=2fregexp.html'>https://docs.ruby-lang.org/ja/latest/doc/spec=2fregexp.html</a>
				</section>
				<section>
					<h2>è¨˜äº‹ (blogs, wikis) ã®æ­£è¦è¡¨ç¾</h2>
					<h3>æ­£è¦è¡¨ç¾ã®ã‚­ãƒ£ãƒ—ãƒãƒ£</h3>
					<pre><code class='ruby'>TITLE_PATTERN = %r[\A.*
	/kibela-#{TEAM}-\d+
	/(?&lt;kind&gt;wikis|blogs)
	/(?&lt;path&gt;[[:print:]]*/)*
	(?&lt;id&gt;\d)+-(?&lt;name&gt;[[:print:]]*)\.md\z]x</code></pre>
	<pre><code class="ruby">regexp = TITLE_PATTERN.match(filepath)
regexp[:kind] # ã“ã‚Œã§blogsãªã®ã‹wikisãªã®ã‹ã‚ã‹ã‚‹
regexp[:path] # ã“ã‚Œã§è¨˜äº‹ã®ã‚«ãƒ†ã‚´ãƒªãŒã‚ã‹ã‚‹
regexp[:name] # ã“ã‚Œã§è¨˜äº‹ã®åå‰ãŒå–ã‚Œã‚‹</code></pre>
				</section>
				<section>
					<h2>ç¬¬ä¸€é–¢é–€çªç ´ğŸ‰ğŸ‰</h2>
				</section>
				<section>
					<h2>ç¬¬äºŒé–¢é–€ğŸ˜¨</h2>
					<pre><code class="ruby">ATTACHMENT_PATTERN = %r[^(?~http)
  (\.\./)*attachments/
  (?&lt;attachment_name&gt;\d+\.
    (png|JPG|jpg|jpeg|gif|PNG))
  ]x</code></pre>
				</section>
				<section>
					<h2>kibelaã®è¨˜äº‹ã«è²¼ã‚‰ã‚ŒãŸç”»åƒ</h2>
					<pre><code class='html'>&lt;img
 title='foo'
 src='../../../../attachments/6.png' # ã“ã®'6.png'ãŒæ¬²ã—ã„
 width="662"
 data-meta='{"width":662,"height":195}'&gt;</code></pre>
<p>ã¡ãªã¿ã«ã“ã‚Œã¯markdownå†…ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™</p>
				</section>
				<section>
					<h2>kibelaã®è¨˜äº‹ã«è²¼ã‚‰ã‚ŒãŸç”»åƒ</h2>
					<h3>srcã®ä¸­ã‚’å–å¾—ã—ãŸã„</h3>
					<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">ã‚€ã—ã‚ƒãã—ã‚ƒã—ã¦HTML tagã‚’å«ã‚€markdownã‚’Nokoginiã«æŠ•ã’ãŸã‚‰ã„ã„æ„Ÿã˜ã®çµæœãŒå¸°ã£ã¦ãã¦æœ€é«˜ã®æ°—åˆ†</p>&mdash; ã†ãªã™ã‘ (@yu_suke1994) <a href="https://twitter.com/yu_suke1994/status/1089215416986030081?ref_src=twsrc%5Etfw">2019å¹´1æœˆ26æ—¥</a></blockquote>
				</section>
				<section>
					<h2>kibelaã®è¨˜äº‹ã«è²¼ã‚‰ã‚ŒãŸç”»åƒ</h2>
					<h3>ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™å ´åˆã®ã¿</h3>
					<ul>
						<li>full URLã§ãªãç›¸å¯¾path</li>
						<li>éšå±¤ã¯ä»»æ„ã®æ·±ã•</li>
						<li>attachments/æ•°å­—.æ‹¡å¼µå­ ã§çµ‚ã‚ã‚‹</li>
					</ul>
				</section>
				<section>
					<h2>kibelaã®è¨˜äº‹ã«è²¼ã‚‰ã‚ŒãŸç”»åƒ</h2>
					<h3>ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™å ´åˆã®ã¿</h3>
					<ul>
						<li>full URLã§ãªãç›¸å¯¾path â† åœ°å‘³ã«ã‚­ãƒ„ã„</li>
						<li>éšå±¤ã¯ä»»æ„ã®æ·±ã• â† ã‚ã‹ã‚‹</li>
						<li>attachments/æ•°å­—.æ‹¡å¼µå­ ã§çµ‚ã‚ã‚‹ â† æ¥½å‹</li>
					</ul>
				</section>
				<section>
					<h2>éåŒ…å«æ¼”ç®—å­</h2>
					<blockquote>(?~å¼) ã¨ã„ã†è¨˜æ³•ã§ã€å¼ã«ãƒãƒƒãƒã™ã‚‹æ–‡å­—åˆ—ã‚’å«ã¾ãªã„ä»»æ„ã®æ–‡å­—åˆ—ã«ãƒãƒƒãƒã—ã¾ã™ã€‚</blockquote>
					<a href='https://docs.ruby-lang.org/ja/latest/doc/spec=2fregexp.html'>https://docs.ruby-lang.org/ja/latest/doc/spec=2fregexp.html</a>
					<p>æœ€é«˜ï¼ï¼</p>
				</section>
				<section>
					<h2>éåŒ…å«æ¼”ç®—å­ã«ã¤ã„ã¦</h2>
					<ul>
						<li>Ruby 2.4.1ã‹ã‚‰ä½¿ç”¨å¯èƒ½</li>
						<li>ç”°ä¸­å“²ã•ã‚“ã«ã‚ˆã‚‹ææ¡ˆãŒã‚‚ã¨</li>
						<ul><li><a href="https://staff.aist.go.jp/tanaka-akira/pub/prosym49-akr-presen.pdf">æ­£è¦è¡¨ç¾ã«ãŠã‘ã‚‹éåŒ…å«ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ã®ææ¡ˆ</a></li></ul>
						<li>æ­£è¦è¡¨ç¾ã‚¨ãƒ³ã‚¸ãƒ³Onigmoã«å®Ÿè£…ã•ã‚Œã¦ä½¿ç”¨å¯èƒ½ã«</li>
					</ul>
					<br>
					<br>
					<small>è¨€èªæ¨™æº–ã§ã“ã®æ©Ÿèƒ½ãŒä½¿ãˆã‚‹ã®ã¯Rubyã ã‘ï¼Ÿ</small>
				</section>
				<section>
					<h2>exportã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ </h2>
					<h3>ç”»åƒåã®æ­£è¦è¡¨ç¾</h3>
					<pre><code class="ruby">ATTACHMENT_PATTERN = %r[
  ^ # æ–‡å­—åˆ—ã®å…ˆé ­
  (?~http) # http ã§é–‹å§‹ã—ãªã„
  (\.\./)*attachments/ # ä»»æ„ã®éšå±¤/attachmentsã«ãƒãƒƒãƒ
	(?&lt;attachment_name&gt;\d+ # ç”»åƒå(æ•°å­—)
  \.(png|JPG|jpg|jpeg|gif|PNG)) # ç”»åƒå(æ‹¡å¼µå­)
	]x</code></pre>
				</section>
				<section>
					<h2>ã¾ã¨ã‚</h2>
					<ul>
						<li>éåŒ…å«æ¼”ç®—å­ã¯ä¾¿åˆ©</li>
						<ul><li>Rubyã§æ›¸ã„ã¦ã‚ˆã‹ã£ãŸ</li></ul>
						<li>æ­£è¦è¡¨ç¾ã¯ä¾¿åˆ©</li>
						<ul><li>å®¹æ˜“ã«èª­ã¿ã«ããã§ãã‚‹ã®ã§æ³¨æ„</li></ul>
						<li><a href="https://github.com/HolyGrail/kibela2esa">HolyGrail/kibela2esa</a>ã«starãŠé¡˜ã„ã—ã¾ã™</li>
					</ul>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				history: true,
				transition: 'none',
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
